@startuml
!theme aws-orange
skinparam backgroundColor #FAFAFA
skinparam participant {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    FontColor #1565C0
    FontSize 12
    FontStyle bold
}
skinparam arrow {
    Color #1976D2
    FontColor #424242
    FontSize 10
}
skinparam note {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
    FontColor #E65100
}

title <size:16><color:#1565C0>üöÄ –î—ñ–∞–≥—Ä–∞–º–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ: –û–±—Ä–æ–±–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ LogistiTrack</color></size>

actor "üë§\n–ö–ª—ñ—î–Ω—Ç" as Customer #FFE0B2
participant "üñ•Ô∏è\nFrontend" as Frontend #E1F5FE
participant "üîê\nAuth" as Auth #F3E5F5
participant "üì¶\nOrder API" as OrderAPI #E8F5E8
participant "üìä\nInventory" as Inventory #FFF8E1
participant "üóÑÔ∏è\nDatabase" as DB #EFEBE9
participant "üó∫Ô∏è\nMapbox" as Mapbox #E0F2F1
participant "üöõ\nLogistics" as Logistics #FCE4EC
participant "üîî\nNotifications" as Notifications #F1F8E9

== üìù –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ==

Customer -> Frontend: <color:#2E7D32>**1.** –°—Ç–≤–æ—Ä—é—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è\n(—Ç–æ–≤–∞—Ä–∏ + –∞–¥—Ä–µ—Å–∞)</color>
activate Frontend #E3F2FD

Frontend -> Auth: <color:#7B1FA2>**2.** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</color>
activate Auth #F3E5F5
Auth --> Frontend: <color:#7B1FA2>**3.** ‚úÖ JWT –≤–∞–ª—ñ–¥–Ω–∏–π</color>
deactivate Auth

Frontend -> Frontend: <color:#F57C00>**4.** –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö</color>
note right of Frontend #FFF3E0
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:
  ‚Ä¢ –û–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è
  ‚Ä¢ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö
  ‚Ä¢ –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤
end note

Frontend -> Inventory: <color:#388E3C>**5.** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—ñ–≤</color>
activate Inventory #FFF8E1

Inventory -> DB: <color:#5D4037>**6.** SELECT –∑–∞–ø–∞—Å–∏</color>
activate DB #EFEBE9
DB --> Inventory: <color:#5D4037>**7.** –î–∞–Ω—ñ –ø—Ä–æ –∑–∞–ø–∞—Å–∏</color>
deactivate DB

alt <color:#D32F2F>‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—ñ–≤</color>
    Inventory --> Frontend: <color:#D32F2F>**8a.** –ü–æ–º–∏–ª–∫–∞: —Ç–æ–≤–∞—Ä –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</color>
    Frontend --> Customer: <color:#D32F2F>**9a.** ‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
else <color:#388E3C>‚úÖ –¢–æ–≤–∞—Ä–∏ —î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</color>
    Inventory --> Frontend: <color:#388E3C>**8b.** ‚úÖ –¢–æ–≤–∞—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ</color>
    deactivate Inventory
    
    Frontend -> Mapbox: <color:#00796B>**9.** –ì–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏</color>
    activate Mapbox #E0F2F1
    Mapbox --> Frontend: <color:#00796B>**10.** üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (lat, lng)</color>
    deactivate Mapbox
    
    Frontend -> OrderAPI: <color:#1976D2>**11.** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
    activate OrderAPI #E8F5E8
    
    OrderAPI -> DB: <color:#5D4037>**12.** INSERT –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
    activate DB #EFEBE9
    DB --> OrderAPI: <color:#5D4037>**13.** üÜî order_id</color>
    
    loop <color:#FF6F00>–î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É</color>
        OrderAPI -> DB: <color:#5D4037>**14.** INSERT —Ç–æ–≤–∞—Ä</color>
        note over DB #FFF3E0
          –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç—Ä–∏–≥–µ—Ä
          –æ–Ω–æ–≤–ª—é—î –∑–∞–≥–∞–ª—å–Ω—É —Å—É–º—É
        end note
    end
    
    DB --> OrderAPI: <color:#5D4037>**15.** ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ</color>
    deactivate DB
    
    OrderAPI --> Frontend: <color:#1976D2>**16.** ‚úÖ –£—Å–ø—ñ—Ö</color>
    deactivate OrderAPI
    
    Frontend --> Customer: <color:#2E7D32>**17.** üéâ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!</color>
end

deactivate Frontend

== üëî –û–±—Ä–æ–±–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º ==

participant "üëî\n–ü–µ—Ä—Å–æ–Ω–∞–ª" as Staff #FFECB3

Staff -> Frontend: <color:#F57C00>**18.** –ü–µ—Ä–µ–≥–ª—è–¥–∞—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
activate Frontend #E3F2FD

Frontend -> OrderAPI: <color:#1976D2>**19.** –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π</color>
activate OrderAPI #E8F5E8

OrderAPI -> DB: <color:#5D4037>**20.** SELECT –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
activate DB #EFEBE9
DB --> OrderAPI: <color:#5D4037>**21.** –î–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
deactivate DB

OrderAPI --> Frontend: <color:#1976D2>**22.** –î–µ—Ç–∞–ª—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
deactivate OrderAPI

Staff -> Frontend: <color:#F57C00>**23.** ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>

Frontend -> OrderAPI: <color:#1976D2>**24.** –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É ‚Üí "confirmed"</color>
activate OrderAPI #E8F5E8

OrderAPI -> DB: <color:#5D4037>**25.** UPDATE —Å—Ç–∞—Ç—É—Å</color>
activate DB #EFEBE9

note over DB #E8F5E8
  ü§ñ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏:**
  ‚Ä¢ –†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
  ‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
end note

DB -> Notifications: <color:#689F38>**26.** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</color>
activate Notifications #F1F8E9
Notifications --> Customer: <color:#689F38>**27.** üîî "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ"</color>
deactivate Notifications

DB --> OrderAPI: <color:#5D4037>**28.** ‚úÖ –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ</color>
deactivate DB

OrderAPI --> Frontend: <color:#1976D2>**29.** ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ</color>
deactivate OrderAPI

== üì¶ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ ==

Staff -> Frontend: <color:#F57C00>**30.** –°—Ç–∞—Ç—É—Å ‚Üí "processing"</color>
Staff -> Frontend: <color:#F57C00>**31.** –°—Ç–∞—Ç—É—Å ‚Üí "shipped"</color>

Frontend -> OrderAPI: <color:#1976D2>**32.** –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</color>
activate OrderAPI #E8F5E8

OrderAPI -> DB: <color:#5D4037>**33.** UPDATE —Å—Ç–∞—Ç—É—Å ‚Üí "shipped"</color>
activate DB #EFEBE9

note over DB #FCE4EC
  üöõ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É**
  –¢—Ä–∏–≥–µ—Ä: create_automatic_delivery_route
end note

DB -> Logistics: <color:#C2185B>**34.** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É</color>
activate Logistics #FCE4EC

Logistics -> Mapbox: <color:#00796B>**35.** –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç—É</color>
activate Mapbox #E0F2F1
Mapbox --> Logistics: <color:#00796B>**36.** üó∫Ô∏è –û–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç</color>
deactivate Mapbox

Logistics -> DB: <color:#5D4037>**37.** –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É</color>
deactivate Logistics

DB --> OrderAPI: <color:#5D4037>**38.** ‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ</color>
deactivate DB

OrderAPI --> Frontend: <color:#1976D2>**39.** ‚úÖ –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</color>
deactivate OrderAPI

== üöó –î–æ—Å—Ç–∞–≤–∫–∞ ==

participant "üöó\n–í–æ–¥—ñ–π" as Driver #E8EAF6

Driver -> Frontend: <color:#3F51B5>**40.** –ü–µ—Ä–µ–≥–ª—è–¥–∞—î –º–∞—Ä—à—Ä—É—Ç</color>
activate Frontend #E3F2FD

Frontend -> Logistics: <color:#C2185B>**41.** –û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É</color>
activate Logistics #FCE4EC

Logistics -> DB: <color:#5D4037>**42.** SELECT –º–∞—Ä—à—Ä—É—Ç</color>
activate DB #EFEBE9
DB --> Logistics: <color:#5D4037>**43.** –î–∞–Ω—ñ –º–∞—Ä—à—Ä—É—Ç—É</color>
deactivate DB

Logistics --> Frontend: <color:#C2185B>**44.** –î–µ—Ç–∞–ª—ñ –º–∞—Ä—à—Ä—É—Ç—É</color>
deactivate Logistics

Driver -> Frontend: <color:#3F51B5>**45.** üöÄ –ü–æ—á–∏–Ω–∞—î –¥–æ—Å—Ç–∞–≤–∫—É</color>

Frontend -> Logistics: <color:#C2185B>**46.** –°—Ç–∞—Ç—É—Å ‚Üí "in_progress"</color>
activate Logistics #FCE4EC

Logistics -> DB: <color:#5D4037>**47.** UPDATE –º–∞—Ä—à—Ä—É—Ç</color>
activate DB #EFEBE9

note over DB #E0F2F1
  üìç **GPS –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è**
  –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü—ñ—ó —Ä—É—Ö—É
end note

loop <color:#00796B>üìç GPS –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–∫–æ–∂–Ω—ñ 5 —Å–µ–∫)</color>
    DB -> DB: <color:#5D4037>**48.** UPDATE –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</color>
    DB -> Notifications: <color:#689F38>**49.** Live –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</color>
    activate Notifications #F1F8E9
    Notifications --> Customer: <color:#689F38>**50.** üìç –ü–æ–∑–∏—Ü—ñ—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É</color>
    deactivate Notifications
end

DB --> Logistics: <color:#5D4037>**51.** ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–æ–∑–ø–æ—á–∞—Ç–∞</color>
deactivate DB
deactivate Logistics

== üéØ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏ ==

Driver -> Frontend: <color:#3F51B5>**52.** ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –¥–æ—Å—Ç–∞–≤–∫—É</color>

Frontend -> Logistics: <color:#C2185B>**53.** –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏</color>
activate Logistics #FCE4EC

Logistics -> DB: <color:#5D4037>**54.** UPDATE —Å—Ç–∞—Ç—É—Å ‚Üí "completed"</color>
activate DB #EFEBE9

DB -> OrderAPI: <color:#1976D2>**55.** –°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Üí "delivered"</color>
activate OrderAPI #E8F5E8

OrderAPI -> Notifications: <color:#689F38>**56.** –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –¥–æ—Å—Ç–∞–≤–∫—É</color>
activate Notifications #F1F8E9
Notifications --> Customer: <color:#689F38>**57.** üéâ "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ!"</color>
deactivate Notifications

DB --> OrderAPI: <color:#5D4037>**58.** ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</color>
deactivate OrderAPI

DB --> Logistics: <color:#5D4037>**59.** ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</color>
deactivate DB
deactivate Logistics

Frontend --> Driver: <color:#3F51B5>**60.** ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞</color>
deactivate Frontend

note over Customer, Notifications #E8F5E8
  <size:14><color:#2E7D32>üéâ **–£–°–ü–Ü–®–ù–ï –ó–ê–í–ï–†–®–ï–ù–ù–Ø**</color></size>
  
  ‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª–µ–Ω–æ —Ç–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
  üìä –í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è –∑–≤—ñ—Ç–Ω–æ—Å—Ç—ñ  
  üîî –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º–∞–≤ –≤—Å—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
  üìç GPS —Ç—Ä–µ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É
end note

@enduml